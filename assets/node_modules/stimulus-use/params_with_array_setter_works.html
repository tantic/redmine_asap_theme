<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
</head>
<body data-controller="menu" data-action="click@window->menu#test">

  <script type="module">
    import { Application, Controller } from 'https://cdn.skypack.dev/@hotwired/stimulus@3.0.0'
    const application = Application.start()

    application.register("menu", class extends Controller {
      test() {
        console.log("menu test")
      }
    })

    const button = document.createElement("button")
    button.innerText = "Click me!"
    document.body.append(button)

    const debounce = (fn, wait = 200) => {
      let timeoutId = null

      return function() {
        const args = arguments
        const context = this
        const paramsArray = []

        args.forEach(arg => paramsArray.push(arg.params))
        console.log("args", args[0].params)

        const callback = () => {
          args.forEach((arg, index) => arg.params = paramsArray[index])

          console.log("args in callback", args[0].params)
          return fn.apply(context, args)
        }
        if (timeoutId) {
          clearTimeout(timeoutId)
        }
        timeoutId = setTimeout(callback, wait)
      }
    }

    function myAction(event) {
      console.log("myAction - params", event.params)
    }

    const debouncedMyAction = debounce(myAction, 500)

    button.addEventListener("click", (event) => {
      const myEvent = Object.assign(event, { params: { myId: 321 }})
      debouncedMyAction(myEvent)
    })
  </script>

</body>
</html>
